{% load sstatic %}
{% load user_link %}
{% load links %}

<!doctype html>
<html lang="en">
    <head>
        <title>{{item.name}} - preview - {{SITE_TITLE}}</title>

        <link rel="icon" href="{% sstatic 'icon.png' %}"/>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">

        {% if item.published %}
            {% include 'editoritem/oembed.html' %}
        {% endif %}

        <link rel="stylesheet" href="{% sstatic 'css/preview.css' %}"/>
        {% include "mathjax.html" %}
    </head>
    <body>
        <header role="banner">
            <h1 class="description">
                <a href="{{item.get_absolute_url}}">{{item.name}}</a>
                <span class="light-maroon">in</span>
                <a href="{{item.project.get_absolute_url}}">{{item.project.name}}</a>
            </h1>

            <span class="licence">
            {% if item.licence %}
            <span class="light-maroon no-underline-link"> &copy; </span>
              <!--  <abbr title="{{item.licence.name}}"> -->
                    {% if item.licence.url %}
                        <a class="light-maroon no-underline-link" target="_blank" href="{{item.licence.url}}">{{item.licence.short_name}}</a>
                    {% else %}
                        <span class="light-maroon no-underline-link">{{item.licence.short_name}}</span>
                    {% endif %}
               <!--  </abbr> -->
            {% endif %}
            </span>

            <a href="{{item.get_absolute_url}}">Edit</a>

            <a href="{% editoritem_url 'download' item.rel_obj %}?scorm">Download</a>

            <span class="pointer-effect underline-text" id="share"> Share </span>

            <span  id="embed-url">
                <span class="copied-text-style" id="copied-text"></span>
                <span class="light-maroon" id="link-label">Click <span class="pointer-effect underline-text color-white" id="copy-text">here</span> to copy this link - </span>
                <code tabindex="0"><span class="color-white">{{SITE_ROOT}}{{embed_url}}</span></code>
                <span class="close-button pointer-effect" id="close-button">&nbsp Close &nbsp</span>
            </span>

        </header>
        <main role="main">
        <iframe title="{{item.name}}" src="{{exam_url}}"></iframe>
        </main>


        <script>

            var share_button = document.getElementById('share');
            var embed_display = document.getElementById('embed-url');
            var copy_text = document.getElementById('copy-text');
            var close_button = document.getElementById('close-button');

            /* To toggle the embedded URL area */
            share_button.addEventListener('click',function() {
                embed_display.classList.toggle('shown'); 
                embed_display.focus();
            });

            /* To close the embedded URL when the close is clicked */
            close_button.addEventListener('click',function() {
                embed_display.classList.toggle('shown'); 
                embed_display.focus();
            });

            /* Function to copy the URL to the clipboard */
            copy_text.addEventListener('click',function() {
                                
                /* To copy the URL to clipboard */
                navigator.clipboard.writeText(`{{SITE_ROOT}}{{embed_url}}`);
                
                /* Displays the message that URL is copied to clipboard */
                document.getElementById("copied-text").innerHTML = '<span class="left-right-padding">&nbsp URL Copied &nbsp</span>';

                /* To remove the URL copied message after few seconds */
                setTimeout(function() {
                    document.getElementById("copied-text").innerHTML = ''
                    }, 2000);

            });

            var get_numbas_interval = setInterval(function() {
                var w = window.frames[0];
                if(w && w.Numbas) {
                    window.Numbas = w.Numbas;
                    clearInterval(get_numbas_interval);
                }
            },100);

        </script>
    </body>
</html>
